시스템 설계 면접을 볼 때, 개략적인 규모 추정(back-of-the-envelope estimation)단계가 필요하다.<br>이것은 성능 수치 상에서 사고 실험(thought experiements)을 행해서 추정치를 계산하는 행위이다.<br>
즉, *어떤 설계가 요구사항에 부합할 것인지 보기 위한 것*


기본적으로 개략적 규모 추정을 잘 해내려면 **규모 확장성을 표현하는데 필요한 기본기**에 능숙해야 한다.<br>
ex) 2의 제곱수, 응답지연(latency) 값, 가용성에 관계된 수치들


## 1. 2의 제곱수
기본적으로, 데이터 볼륨의 단위를 2의 제곱수로 표현하면 어떻게 되는지 알아야 한다.

최소 단위: 1byte = 8bits로 구성된다.
ASCII 문자 한개가 차지하는 메모리크기가 1byte이다.

**<흔히 쓰이는 데이터 볼륨 단위들>**

|수치|근사치|축약형|
|------|---|---|
|2^10|1천,thousand|1KB|
|2^20|1백만,million|1MB|
|2^30|10억,billion|1GB|
|2^40|1조,trillion|1TB|
|2^50|1000조,quadrillion|1PB|

각 수치마다 2^10을 곱해 나간다. 1KB는 1byte 에 2^10을 곱한 값이다.

## 2. 모든 프로그래머가 알아야 하는 응답지연(latency) 값
**<통상적인 컴퓨터에서 구현된 연산들의 응답지연 값>**<br>
요즘은 더 빠른 컴퓨터가 등장했지만 일반적인 컴퓨터 연산들의 처리 속도가 어느정도인지 가늠할 수 있다.
- 1000ns가 1us이다.
- 1000,000(1백만)ns가 1ms이다.
- |연산명|시간|
  |------|---|
  |**L1 캐시 참조**|0.5ns|
  |분기 예측 오류(branch mispredict)|5ns|
  |**L2 캐시 참조**|7ns|
  |**뮤텍스(mutex) 락/언락**|0.5ns|
  |**주 메모리 참조**|100ns|
  |Zippy로 1KB 압축|10,000ns = 10us(마이크로초)|
  |1Gbps 네트워크로 2KB 전송|20,000ns = 20us|
  |메모리에서 1MB 순차적으로 read|250,000ns = 250us|
  |같은 데이터 센터 내에서의 메시지 왕복 지연시간|500,000ns = 500us|
  |**디스크 탐색(seek)**|10,000,000ns = 10ms(밀리초)|
  |네트워크에서 1MB 순차적으로 read|10ms|
  |디스크에서 1MB 순차적으로 read|30ms|
  |한 캐밋의 CA(캘리포니아)로부터 네덜란드까지의 왕복 지연시간|150ms|

- 분기 예측 오류???
- 뮤텍스???

**결론**
- 메모리는 빠르지만 디스크는 아직 느리다.
- 디스크 탐색(seek)은 10밀리초(ms)가 걸리므로, 가능한 한 피하라.
- 단순한 압축 알고리즘은 빠르다. (Zippy로 1kb 압축하면 2마이크로초가 걸린다.)
- 데이터를 인터넷으로 보낼 때 최대한 압축해서 보내라
    - 일반 상용 네트워크 상에서 2K 바이트 전송 시 44나노초(ns)가 걸린다.
    - 동일 데이터 센터 내에서의 패킷 왕복 지연시간은 500마이크로초(us) 걸린다.
- 데이터 센터는 보통 여러 region에 분산되어있으므로, 센터들 간에 데이터를 주고 받는데는 시간이 걸린다.<br>(한 패킷의 캘리포니아로부터 네덜란드까지의 왕복시간은 150밀리초이다.)

## 3. 가용성에 관계된 수치들
> **고 가용성** (high availability)이란?<br>
> 시스템이 오랜 시간동안 지속적으로 중단 없이 운영될 수 있는 능력
> - 100% : 시스템이 한번도 중단된 적 없음
> - 대부분의 서비스가 99~100% 사이의 값을 갖는다.

> **SLA** (Service Level Agreement) 란?<br>
> 서비스 사업자와 고객 사이에 맺어진 합의로, 이 합의에는 서비스의 가용시간(uptime)이 공식적으로 기술되어 있다.

가용시간은 관습적으로 9가 많을 수록 좋다고 본다. ex) 99%, 99.9%, 99.99%, 99.999%, 99.9999%..
<br><br>

이제 익힌 지식으로 트위터 QPS(Query Per Second)와 저장소 요구량을 추정해보자.
## 4. 예제: 트위터 QPS(Query Per Second)와 저장소 요구량 추정
1. 가정 (가상의 성능/요구사항이다.)
- 월간 능동 사용자 (monthly active user)는 3억(300million)명
- 50%의 사용자가 트위터를 매일 사용 (1.5억명)
- 평균적으로 각 사용자는 매일 2건의 트윗을 올린다. (3억 개 트윗)
- 미디어를 포함한 트윗은 10% (3억%10=3천개)
- 데이터는 5년간 보관

2. 추정치 구하기
1) QPS (Query Per Second) 추정치
- 일간 능동 사용자(DAU, Daility Active User) : 3억 * 50% = 1.5억 (150 million)
- QPS = 1.5억 * 2트윗 = 3억 /24h / 3600초 => 약 3500 (매 1초)
- 최대 QPS (Peek QPS) = 2 * QPS = 약 7000

2) 미디어 저장을 위한 저장소 요구량
- 평균 트윗 크기
    - tweet_id : 64 byte
    - text : 140 byte
    - media : 1MB
- 미디어 포함 트윗이 10%이므로, 하루 3억 * 10% (=>3천) * 1MB = **3TB / 1d**
    - 1MB * (2^10)^3 = 1MB * (1024)^3 = 1MB * 30000000 = 3TB ..?
- 5년동안 미디어 보관하기 위한 저장소 요구량 : 3TB * 365 * 5 = 5475TB = **55PB**


## 5. 결론
개략적인 규모 추정과 관련된 면접에서 중요한 것은 '문제를 풀어나가는 과정'이다.<br>
문제 해결 능력이 가장 중요한데, 이에 도움되는 방식..
- 근사치를 활용한 계산 (면접장에서 복잡한 계산을 하고 있기 보다 적절한 근사치를 활용해 시간 절약하자)
- 가정 리스트들은 적어두자. 추후 살펴볼 수 있도록!
- 단위(unit)를 붙여서 모호함을 제거하자. TB인지 MB인지..
- 많이 출제되는 개략적 규모 추정 문제 : QPS, 최대 QPS, 저장소 요구량, 캐시 요구량, 서버 수 등을 추정하는 것
    - 이런 값들을 계산하는 연습을 미리 하자!